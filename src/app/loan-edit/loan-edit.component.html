<section class="card">
    <div *ngIf="loan">
    <div class="row">
    <div class="col-lg-12">
        <!--<form id="selects-form">-->
            <section class="card">
                <header class="card-header">
                    <div class="card-actions">
                        <a href="#" class="card-action card-action-toggle" data-card-toggle></a>
                        <a href="#" class="card-action card-action-dismiss" data-card-dismiss></a>
                    </div>
                    <h2 class="card-title">{{ isNewLoan ? 'Nuevo Préstamo' : 'Editar Préstamo' }}</h2>
                </header>
                <div class="card-body">
                    <!-- Campo de usuario - solo visible para admin -->
                    <div class="form-group row pb-3" *ngIf="isAdmin">
                        <label class="col-sm-3 control-label text-sm-end pt-2">Usuario</label>
                        <div class="col-sm-9">
                            <select id="user" name="user" class="form-control" [(ngModel)]="loan.user" title="Please select at least one user" required>
                                <option *ngFor="let user of users" [ngValue]="user">{{ user.name }}</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Información de usuario - solo visible para no-admin -->
                    <div class="form-group row pb-3" *ngIf="!isAdmin">
                        <label class="col-sm-3 control-label text-sm-end pt-2">Usuario</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" [value]="loan.user?.name || 'Cargando...'" disabled>
                        </div>
                    </div>
                    
                    <div class="form-group row pb-3">
                        <label class="col-sm-3 control-label text-sm-end pt-2">Fecha de Inicio</label>
                        <div class="col-sm-9">
                            <input type="date" class="form-control" [(ngModel)]="loan.loanDate" id="loanDate" name="loanDate" required>
                        </div>
                    </div>
                    <div class="form-group row pb-3">
                        <label class="col-sm-3 control-label text-sm-end pt-2">Fecha de Expiración</label>
                        <div class="col-sm-9">
                            <input type="date" class="form-control" [(ngModel)]="loan.expirationDate"  id="expirationDate" name="expirationDate" required>
                        </div>
                    </div>
                    <div class="form-group row pb-3">
                        <label class="col-lg-3 control-label text-lg-end pt-2">Seleccione los libros a prestar</label>
                        <div class="col-lg-9">
                            <select id="books" name="books" [(ngModel)]="loan.books" multiple size="4" data-plugin-selectTwo class="form-control populate" title="Please select at least one state" required>
                                <option *ngFor="let book of books" [ngValue]="book">{{ book.name }}</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Campo de tarifa - solo visible para admin -->
                    <div class="form-group row pb-3" *ngIf="isAdmin">
                        <label class="col-sm-3 control-label text-sm-end pt-2">Tarifa</label>
                        <div class="col-sm-9">
                            <select id="rate" class="form-control" name="rate" [(ngModel)]="loan.rate" title="Please select at least one user" required>
                                <option *ngFor="let rate of rates" [ngValue]="rate">{{ rate.description + ' ($' + rate.value + ')'}}</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Estado del préstamo (si existe) -->
                    <div class="form-group row pb-3" *ngIf="!isNewLoan">
                        <label class="col-sm-3 control-label text-sm-end pt-2">Estado</label>
                        <div class="col-sm-9">
                            <span [class]="'badge ' + (loan.status === 'aprobado' ? 'badge-success' : loan.status === 'rechazado' ? 'badge-danger' : loan.status === 'finalizado' ? 'badge-secondary' : 'badge-warning')">
                                {{ loan.status === 'aprobado' ? 'Aprobado' : loan.status === 'rechazado' ? 'Rechazado' : loan.status === 'finalizado' ? 'Finalizado' : 'Creado' }}
                            </span>
                        </div>
                    </div>
                </div>
                <footer class="card-footer">
                    <div class="row justify-content-end">
                        <div class="col-sm-9">
                            <button class="btn btn-primary" (click)="saveLoan(loan)">Guardar</button>
                        </div>
                    </div>
                </footer>
            </section>
        <!--</form>-->
    </div>
    </div>
    </div>
</section>